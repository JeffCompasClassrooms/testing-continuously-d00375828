name: Test Orchestrator

on:
  workflow_dispatch: {}

jobs:
  run-tests:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout orchestrator repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.12"

      # --- Repo 1: systems ---
      - name: Checkout testing-systems repo
        uses: actions/checkout@v4
        with:
          repository: JeffCompasClassrooms/testing-systems-d00375828
          path: testing-systems

      - name: Run tests for testing-systems
        working-directory: testing-systems
        continue-on-error: true
        run: |
          python -m pip install --upgrade pip
          pip install pytest pytest-describe behave requests
          pytest

      # --- Repo 2: behave ---
      - name: Checkout testing-with-behave repo
        uses: actions/checkout@v4
        with:
          repository: JeffCompasClassrooms/testing-with-behave-d00375828
          path: testing-with-behave

      - name: Set up Python for Behave repo
        uses: actions/setup-python@v5
        with:
          python-version: "3.12"

      - name: Install Python dependencies (Behave repo)
        run: |
          python -m pip install --upgrade pip
          pip install behave selenium

      - name: Install Chrome and ChromeDriver (Behave repo)
        uses: browser-actions/setup-chrome@v2
        with:
          install-dependencies: true
          install-chromedriver: true

      - name: Run Behave tests for peppers-ghost
        working-directory: testing-with-behave/peppers-ghost
        run: |
          python -m behave

      # --- Repo 3: units ---
      - name: Checkout testing-units repo
        uses: actions/checkout@v4
        with:
          repository: JeffCompasClassrooms/se3150-testing-units-f25-SE3150-Testing-Unit
          path: testing-units

      - name: Run tests for testing-units
        working-directory: testing-units
        run: |
          python -m pip install --upgrade pip
          pip install pytest pytest-describe behave requests
          pytest
